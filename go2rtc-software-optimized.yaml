streams:
  # Main camera - Direct RTSP connection
  tapo_main:
    - rtsp://secretlab:Airp0rt!@10.1.10.149:554/stream1
  
  # TEST: Direct passthrough (no processing) - use this to test if lag is from processing
  tapo_direct:
    - rtsp://secretlab:Airp0rt!@10.1.10.149:554/stream1
  
  # Dewarped - Optimized software encoding
  # 20-30% less CPU, 20-40ms less latency
  tapo_dewarped:
    - ffmpeg:tapo_main#video=h264#raw=-fflags nobuffer+genpts -flags low_delay -probesize 32 -analyzeduration 0 -threads 0 -vf lenscorrection=cx=0.5:cy=0.5:k1=-0.23:k2=-0.02,crop=1700:956:110:62,scale=1920:1080 -c:v libx264 -preset veryfast -tune zerolatency -crf 28 -g 10 -bf 0 -x264-params keyint=10:min-keyint=5:scenecut=0:bframes=0:ref=1:me=dia:subme=1:trellis=0
  
  # Close-up - Optimized software encoding
  tapo_closeup:
    - ffmpeg:tapo_main#video=h264#raw=-fflags nobuffer+genpts -flags low_delay -probesize 32 -analyzeduration 0 -threads 0 -vf lenscorrection=cx=0.5:cy=0.5:k1=-0.23:k2=-0.02,crop=1152:648:384:216,scale=1920:1080 -c:v libx264 -preset veryfast -tune zerolatency -crf 28 -g 10 -bf 0 -x264-params keyint=10:min-keyint=5:scenecut=0:bframes=0:ref=1:me=dia:subme=1:trellis=0
  
  # Machine 1 - Single-pass processing (dewarp + crop in one go)
  tapo_machine_1:
    - ffmpeg:tapo_main#video=h264#raw=-fflags nobuffer+genpts -flags low_delay -probesize 32 -analyzeduration 0 -threads 2 -vf lenscorrection=cx=0.5:cy=0.5:k1=-0.23:k2=-0.02,crop=1700:956:110:62,crop=346:586:612:176,scale=1920:1080 -c:v libx264 -preset veryfast -tune zerolatency -crf 28 -g 10 -bf 0 -x264-params keyint=10:min-keyint=5:scenecut=0:bframes=0:ref=1:me=dia:subme=1:trellis=0
  
  # Machine 2 - Single-pass processing (dewarp + crop in one go)
  tapo_machine_2:
    - ffmpeg:tapo_main#video=h264#raw=-fflags nobuffer+genpts -flags low_delay -probesize 32 -analyzeduration 0 -threads 2 -vf lenscorrection=cx=0.5:cy=0.5:k1=-0.23:k2=-0.02,crop=1700:956:110:62,crop=343:586:841:176,scale=1920:1080 -c:v libx264 -preset veryfast -tune zerolatency -crf 28 -g 10 -bf 0 -x264-params keyint=10:min-keyint=5:scenecut=0:bframes=0:ref=1:me=dia:subme=1:trellis=0
  
  # Machine 3 - Single-pass processing (dewarp + crop in one go)
  tapo_machine_3:
    - ffmpeg:tapo_main#video=h264#raw=-fflags nobuffer+genpts -flags low_delay -probesize 32 -analyzeduration 0 -threads 2 -vf lenscorrection=cx=0.5:cy=0.5:k1=-0.23:k2=-0.02,crop=1700:956:110:62,crop=458:606:1146:168,scale=1920:1080 -c:v libx264 -preset veryfast -tune zerolatency -crf 28 -g 10 -bf 0 -x264-params keyint=10:min-keyint=5:scenecut=0:bframes=0:ref=1:me=dia:subme=1:trellis=0

webrtc:
  listen: ':8555'
  ice_servers:
    - urls:
        - stun:stun.l.google.com:19302

api:
  listen: ':1984'

log:
  level: info





